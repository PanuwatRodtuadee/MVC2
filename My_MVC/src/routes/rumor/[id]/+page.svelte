<script>
    export let data;
    export let form;
  
<<<<<<< HEAD
    // 1. ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö ID ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    let selectedUserId = "";
  
    // 2. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô Auditor ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πà isAuditor ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô true)
    $: isAuditor = data.users.find(u => u.id == selectedUserId)?.role === 'auditor';
=======
    let selectedUserId = "";
  
    $: isAuditorSelected = data.users.find(u => u.id == selectedUserId)?.role === 'auditor';
>>>>>>> 5f708650907fd91cd7a35412458bc768eaaf21fb
  </script>
  
  <div class="container mt-5">
    <a href="/" class="btn btn-secondary mb-3">&larr; ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
  
    {#if form?.message}
      <div class="alert {form.success ? 'alert-success' : 'alert-danger'}">{form.message}</div>
    {/if}
  
    <div class="card mb-4 shadow">
      <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
        <h3>{data.rumor.title}</h3>
        
        {#if data.rumor.is_verified}
            <span class="badge bg-success fs-6">‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>
        {:else}
            <span class="badge {data.rumor.status === 'panic' ? 'bg-danger' : 'bg-warning text-dark'}">
              {data.rumor.status.toUpperCase()}
            </span>
        {/if}
      </div>
      <div class="card-body">
          <p class="lead">{data.rumor.content}</p>
          <p><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠:</strong> {data.rumor.credibility_score}%</p>
      </div>
    </div>
  
    <div class="row">
      <div class="col-md-6">
          <div class="card bg-light">
              <div class="card-body">
                  <h4>‚öôÔ∏è ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ç‡πà‡∏≤‡∏ß</h4>
                  
                  <form method="POST" action="?/report">
                      
                      <div class="mb-3">
                          <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</label>
                          <select name="userId" class="form-select" bind:value={selectedUserId} required>
                              <option value="" disabled selected>-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                              {#each data.users as u}
                                  <option value={u.id}>{u.name} ({u.role})</option>
                              {/each}
                          </select>
                      </div>
  
                      {#if isAuditor}
                          <div class="alert alert-success border-success">
                              <h6>üõ°Ô∏è ‡πÇ‡∏´‡∏°‡∏î‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h6>
                              <div class="mb-3">
                                  <label class="form-label fw-bold">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô</label>
                                  <input type="password" name="password" class="form-control" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô..." required>
                              </div>
                              <button type="submit" class="btn btn-success w-100">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Verify)</button>
                          </div>
                      {:else}
                          <div class="mb-3">
                              <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</label>
                              <select name="type" class="form-select">
                                  <option>‡∏ö‡∏¥‡∏î‡πÄ‡∏ö‡∏∑‡∏≠‡∏ô</option>
                                  <option>‡∏õ‡∏•‡∏∏‡∏Å‡∏õ‡∏±‡πà‡∏ô</option>
                                  <option>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡πá‡∏à</option>
                              </select>
                          </div>
                          <button type="submit" class="btn btn-danger w-100">üö® ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                      {/if}
  
                  </form>
              </div>
          </div>
      </div>
  
      <div class="col-md-6">
          <h4>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ({data.rumor.reports.length})</h4>
          <ul class="list-group">
              {#each data.rumor.reports as r}
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                      <span>
                          <strong>{r.user.name}</strong> ‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤: {r.type}
                      </span>
                      <small class="text-muted">{new Date(r.report_date).toLocaleTimeString()}</small>
                  </li>
              {/each}
          </ul>
      </div>
    </div>
  </div>